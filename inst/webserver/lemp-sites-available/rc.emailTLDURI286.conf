server {
  listen 443 ssl http2;
  listen [::]:443 ssl http2;
  server_name rc.emailTLDURI286;

  autoindex off;
  charset utf-8;

  location / {
    root /srv/www/html/emailTLD286.rc;

    # Favicon
    location ~ ^/webmail/favicon.ico$ {
      root /usr/share/webapps/roundcubemail/skins/classic/images;
      log_not_found off;
      access_log off;
      expires max;
    }
    # Robots file
    location ~ ^/webmail/robots.txt {
      allow all;
      log_not_found off;
      access_log off;
    }
    # Deny Protected directories
    location ~ ^/webmail/(config|temp|logs)/ {
       deny all;
    }
    location ~ ^/webmail/(README|INSTALL|LICENSE|CHANGELOG|UPGRADING)$ {
      deny all;
    }
    location ~ ^/webmail/(bin|SQL)/ {
      deny all;
    }
    # Hide .md files
    location ~ ^/webmail/(.+\.md)$ {
      deny all;
    }
    # Hide all dot files
    location ~ ^/webmail/\. {
      deny all;
      access_log off;
      log_not_found off;
    }
    # Roundcube fastcgi config
    location ~ /webmail(/.*\.php)$ {
      #include fastcgi.conf; # Roundcube stock fastcgi config?
      include /etc/nginx/php_fastcgi.conf;
      fastcgi_pass unix:/run/php-fpm/php-fpm.sock;
      fastcgi_split_path_info ^/webmail/(.+\.php)(/.*)$;
      fastcgi_index index.php;
      fastcgi_param SCRIPT_FILENAME $request_filename;
      fastcgi_param PATH_INFO $fastcgi_path_info;
      fastcgi_param PHP_VALUE open_basedir="/tmp/:/var/cache/roundcubemail:/usr/share/webapps/roundcubemail:/etc/webapps/roundcubemail:/usr/share/pear/:/var/log/roundcubemail";
    }
  }
  ssl_certificate /etc/ssl/server/server.crt;
  ssl_certificate_key /etc/ssl/server/server.key;
  ssl_dhparam /etc/ssl/server/dhparams.pem;
  #INKVERB-INKCERT=INK_NOT_YET

}

# Redirect all http to https
server {
  listen 80;
  listen [::]:80;
  server_name rc.emailTLDURI286;

  return 301 https://$host$request_uri;
}
